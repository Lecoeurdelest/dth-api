# syntax=docker/dockerfile:1.4
# Development Dockerfile with Gradle for hot-reload
FROM gradle:8.5-jdk17

WORKDIR /app

# Install additional tools including wait-for-it
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    netcat-openbsd \
    && rm -rf /var/lib/apt/lists/*

# Install wait-for-it script for smart DB waiting
RUN wget -O /usr/local/bin/wait-for-it https://github.com/vishnubob/wait-for-it/raw/master/wait-for-it.sh \
    && chmod +x /usr/local/bin/wait-for-it

# Copy Gradle files
COPY gradle ./gradle
COPY build.gradle.kts settings.gradle.kts gradle.properties ./

# Pre-download dependencies with cache mount (faster!)
RUN --mount=type=cache,target=/root/.gradle/caches \
    --mount=type=cache,target=/root/.gradle/wrapper \
    gradle dependencies --no-daemon || true

# Expose port
EXPOSE 8080

# Default command - will be overridden by docker-compose
# Use system gradle (from base image) since gradlew may not be available after volume mount
# Note: In dev mode, volumes will mount source code, so files from COPY above may be overridden
CMD ["gradle", "bootRun", "--continuous"]

